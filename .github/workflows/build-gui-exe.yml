name: Build GUI EXE

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller aiohttp
    
    - name: Build GUI EXE
      run: |
        pyinstaller --onefile --windowed --name="ProxyChecker" --hidden-import=aiohttp --hidden-import=asyncio --collect-all aiohttp proxy_checker.py
    
    - name: Package release
      run: |
        New-Item -ItemType Directory -Force -Path release
        Copy-Item "dist\ProxyChecker.exe" "release\"
        Copy-Item "README.md" "release\"
        Copy-Item "proxies_example.txt" "release\"
        
        "Proxy Checker - Quick Start`n`nUSAGE:`n  1. Double click ProxyChecker.exe`n  2. Import or paste proxy list`n  3. Click Start Check`n  4. View results`n`nPROXY FORMAT:`n  192.168.1.1:8080`n  http://192.168.1.2:8080`n  socks5://192.168.1.3:1080" | Out-File -FilePath "release\QuickStart.txt" -Encoding UTF8
        
        Compress-Archive -Path "release\*" -DestinationPath "ProxyChecker.zip"
    
    - name: Upload Artifact
      uses: actions/upload-artifact@v3
      with:
        name: ProxyChecker-GUI
        path: ProxyChecker.zip
        retention-days: 7
    
    - name: Display completion message
      run: |
        echo "=========================================="
        echo "Build completed successfully!"
        echo "=========================================="
        echo "Download from the Artifacts section above"
